\chapter{Measurements of the CERN T10 beam flux}
\label{sec:hptpc_beam_flux}

\section{Motivation}
\label{sec:hptpc_beam_flux:motivation}

As mentioned in \citesec{sec:theory:currentState}, one of the targets of the next generation of long baseline neutrino oscillation experiments is the measurement of \dcp.
In order to make this measurement, systematic uncertainties will have to be significantly reduced.
In the current generation of neutrino oscillation experiments, uncertainties relating to the neutrino-nucleus interaction model make up a large part of the overall systematic budget.
For example, NOvA's most recent results assign systematic uncertainties from its interaction model of $3.2-5.8\%$ on its \nue and \anue signal rates~\cite{novaRecent}.
The T2K experiment has reported systematic uncertainties of $7-9\%$ on the rate of far detector electron-like events (after the near detector constraint has been applied) where cross-section uncertainties are the largest part of this~\cite{t2kRecent}.

Reducing these systematic uncertainties relies upon better modelling of neutrino-nucleus interactions.
It is also important to have an accurate interaction model in order to infer the neutrino energy from the observed events.
A illustrative diagram showcasing the dependence on the interaction model is shown in \citefig{fig:fsiDiag}.

\begin{figure}[h]
  \centering
  \includegraphics[width=\linewidth]{files/figures/hptpc_beam_flux/fsiDiag}
  \caption[Simplified diagram of nuclear effects in neutrino nucleus interactions]{Simplified diagram of nuclear effects in neutrino nucleus interactions for a hypothetical quasielastic \numu interaction. Taken from~\cite{nuisanceTalk}.}
  \label{fig:fsiDiag}
\end{figure}

As \citefig{fig:fsiDiag} shows, in the simplest case a neutrino nucleus interaction (in this case a CC quasi-elastic one) can be thought of as a neutrino interacting with a free nucleon.
However, within a nucleus the nucleons are not static -- they have some initial momentum which will modify the kinematics of the outgoing particle.
Additionally within a nucleus, additional effects can occur due to correlations between nucleons.
Finally, as the outgoing particles propagate through the nucleus they can interact with other nucleons.
These `final state interactions' (FSI) can modify both the outgoing particles and their kinematics.

Given that in a detector only the outgoing particles can be observed, we are reliant on neutrino interaction models of the initial nuclear state, nuclear effects and FSI in order to correctly reconstruct the neutrino energy.
For example, at the DUNE experiment the primary neutrino interaction type is resonant single pion production, caused by the interaction of a neutrino with a nucleon within an argon nucleus.
This can be represented for muon neutrinos as
\begin{align}
  \numu + p &\rightarrow \muminus + \Delta^{++} \rightarrow \muminus + p + \piplus \\
  \numu + n &\rightarrow \muminus + \Delta^{+} \rightarrow \muminus + n + \piplus \\
  \numu + n &\rightarrow \muminus + \Delta^{+} \rightarrow \muminus + p + \pizero \, .
\end{align}

However, the pions emitted in this process can interact with other nucleons as they progress through the nucleus, leading to their absorption.
If this occurs, the outgoing pion will not be detected and the reconstructed hadronic energy will be biased by the mass of the pion.

Models of final state interactions are not consistent between different neutrino interaction generators.
Of the most commonly used neutrino interaction generators, GENIE~\cite{genie}, NuWro~\cite{nuwro} and NEUT~\cite{neut} all model FSI using intranuclear cascade models tuned on external hadron-nucleus scattering data.
The generator GiBUU~\cite{gibuu} meanwhile, solves the semi-classical Boltzmann-Uehling-Uhlenbeck equation in order to simulate FSI.

However, proton-nucleus scattering measurements are either sparse or non-existent in the energy region of interest or on the desired nucleus.
This is shown in \citefig{fig:protonNucleus} which compares data with a semi-empirical model.
One can see that, for several of the displayed nuclei, large energy regions have no measurements.
This lack of data leads to different parametrisations being used by different neutrino interaction generators.

\begin{figure}[h]
  \centering
  \includegraphics[width=.8\linewidth]{files/figures/hptpc_beam_flux/DataProtonCrossSections}
  \caption[Proton-nucleus cross-section data compared with a semi-empirical model]{Total reaction cross-sections for protons on a variety of nuclei. The points represent data from~\cite{protonXSecData} while the curves are a semi-empirical model~\cite{protonXSecModel}. Figure from~\cite{hptpcProposal}.}
  \label{fig:protonNucleus}
\end{figure}

\citefig{fig:generatorProtons} shows that these differing parametrisations can lead to discrepant final state kinematics between the generators, particularly at low proton energies.
\citefig{fig:generatorProtons} also shows that much of the discrepancy lies below the proton track production threshold in liquid argon.
Mismodelling of these nuclear effects can lead to significant biases in the measurement of neutrino oscillation parameters~\cite{nuclearMismodelOsc}, an undesirable outcome for future long baseline experiments.


High pressure gas TPCs (HPgTPCs) provide an excellent opportunity to gather proton-nucleus data in these regions of very low proton energy due to low thresholds required for track reconstruction.
To this end, a HPgTPC prototype has been constructed and exposed to a charged particle beam at CERN.
In order to access a flux of low energy protons, the beam was moderated and the HPgTPC was placed in an off-axis position. 
An overview of the beam test is given in \citesec{sec:hptpc_beam_flux:overview} while measurements of the beam flux are presented in \citesec{sec:hptpc_beam_flux:results}

\section{The 2018 beam test}
\label{sec:hptpc_beam_flux:overview}

\subsection{The T10 beamline}
\label{sec:hptpc_beam_flux:overview:t10}

The beam test took place at the T10 beam line in the East Area at CERN.
The T10 beam is derived from the PS beam, consists primarily of protons, charged pions and electrons and has a momentum range of \SIrange{0.8}{6.5}{\giga\electronvolt\per\clight} (corresponds to a proton kinetic energy range of \SIrange{0.3}{5.6}{\giga\electronvolt})~\cite{t10Report}.

\citefig{fig:t10Calc} shows the calculated intensity of the T10 beam as a function of beam momentum, separated by particle species.
One can see that charged pions dominate at all momenta, with the effect becoming more pronounced at lower beam momenta.

\begin{figure}[h]
  \centering
  \includegraphics[width=.6\linewidth]{files/figures/hptpc_beam_flux/t10Comp}
  \caption[Calculated intensity of the CERN T10 beam as a function of selected beam momentum and particle species.]{Calculated intensity of the CERN T10 beam as a function of selected beam momentum and particle species, from~\cite{t10Report}.}
  \label{fig:t10Calc}
\end{figure}

\citefig{fig:unmoderatedBeam}, left, shows the time of flight spectrum for the unmoderated T10 beam at a momentum setting of \SI{0.8}{\giga\electronvolt\per\clight}.
In this case the baseline is \SI{10.8}{\metre}.
Within \citefig{fig:unmoderatedBeam}, left, there are several peaks caused by different particle species, including protons.
The particle identification process will be covered in more detail in \citesec{sec:hptpc_beam_flux:methods}.
One can see from \citefig{fig:unmoderatedBeam}, right, that even at this momentum setting there is a negligible flux of protons with kinetic energies of less than \SI{0.1}{\giga\electronvolt}.

\begin{figure}[h]
  \begin{minipage}[t]{.5\textwidth}
    \begin{adjustbox}{max totalsize=\textwidth, center}
      \input{files/figures/hptpc_beam_flux/utofNoBend}
    \end{adjustbox}
  \end{minipage}
  \begin{minipage}[t]{.5\textwidth}
    \begin{adjustbox}{max totalsize=\textwidth, center}
      \input{files/figures/hptpc_beam_flux/protonKeNoBend}
    \end{adjustbox}
  \end{minipage}
  \caption[Time of flight spectrum and proton kinetic energy for the unmoderated and unbent T10 beam]{Left: time of flight spectrum of the unmoderated and unbent CERN T10 beam across a baseline of \SI{10.8}{\metre}. Right: measured kinetic energies of protons in the unmoderated and unbent CERN T10 beam.}
  \label{fig:unmoderatedBeam}
\end{figure}

It is necessary to modify the T10 beam for several reasons, one of them being the lack of the low energy protons.
Additionally, it is important to reduce the multiplicity of particles entering the HPgTPC due to the speed of the optical readout which could otherwise become overwhelmed.
Finally, it is desirable to modify the proton-minimum ionising particle (MIP) ratio in order to isolate more particles which are of interest to a cross-section analysis.

Therefore, two modification are made to the beam flux in order to achieve these goals.
Firstly up to four \SI{10 x 10 x 10}{\cm} acrylic moderator blocks are placed in the beam.
These blocks have the effect of scattering the incident particles and reducing their energy.
Additionally, the HPgTPC is moved to an off-axis angle in order to maximise the ratio of protons to MIPs.
From previous GEANT~\cite{geant} simulations it is determined that the optimal off-axis angle for the HPgTPC is between \ang{2} and \ang{3}.

However, due to space constraints in the beam hall, the HPgTPC could not be moved this far off-axis.
Instead, the beam was steered approximately \ang{1} off its nominal axis to increase the angle between the beam and the HPgTPC.
A bird's-eye view diagram of the experimental setup, which shows the beam position relative to the HPgTPC, is shown in \citefig{fig:beamSetup}.

\begin{figure}[h]
  \centering
  \includegraphics[width=\linewidth]{files/figures/hptpc_beam_flux/hptpc_t10_planview}
  \caption[Bird's-eye view of the experimental setup within the T10 beam area]{Bird's-eye view of the experimental setup within the T10 beam area, from~\cite{beampaper}.}
  \label{fig:beamSetup}
\end{figure}

The effectiveness of this off-axis technique was assessed using several timing points which were used to measure the particle species and energies upstream and downstream of the HPgTPC prototype.
These timing points are shown in \citefig{fig:beamSetup} and, from upstream to downstream, consist of:
\begin{itemize}
    \item \SOne, a \SI{40 x 40 x 5}{\mm} plastic scintillator cross, described in \citesec{sec:hptpc_beam_flux:overview:s1s2};
    \item \STwo, a \SI{120 x 120 x 5}{\mm} plastic scintillator tile, used for coincidence measurements with \SOne, described in \citesec{sec:hptpc_beam_flux:overview:s1s2};
    \item \SThree, a large panel of plastic scintillator bars placed directly upstream of the TPC vessel, described in \citesec{sec:hptpc_beam_flux:overview:s3};
    \item \SFour, a large panel of plastic scintillator bars placed directly downstream of the HPgTPC, which is described in \citesec{sec:hptpc_beam_flux:overview:s4} (its characterisation is described in \citesec{sec:hptpc_dtof_characterisation}).
\end{itemize}
The moderator blocks were placed on a tripod stand in between \SOne and \STwo.



\subsection{Survey and coordinate system}
\label{sec:hptpc_beam_flux:overview:survey}

The distances to the various objects in the beamline from an origin point is measured by the CERN Survey, Mechatronics and Measurements (SMM) group to a precision of \SI{0.5}{\mm}.
Specifically, multiple points on each of \SOne, \STwo, \SThree, \SFour and the HPgTPC prototype were measured.
From these measurements, the distance between various timing points is calculated and displayed in \citetab{tab:pointDistances}, calculated using this survey data

\begin{table}
  \centering
  \caption[Calculated distances between objects within the T10 beamline during the beam test]{Calculated distances between objects within the T10 beamline during the beam test}
  \label{tab:pointDistances}
  \begin{tabular}{c c}
    \hline
    \hline
    Points & Distance between centres / m \\
    \hline
    $\text{Beam monitor} - \SOne$ & \num{0.288(1)} \\
    $\SOne - \STwo$ & \num{1.419(1)} \\
    $\SOne - \SThree$ & \num{10.756(1)} \\
    $\SThree - \text{TPC US side}$ & \num{1.323(2)} \\
    $\text{TPC DS side} - \SFour$ & \num{0.918(2)} \\
    $\STwo - \SFour$ & \num{12.651(1)} \\
    \hline
  \end{tabular}
\end{table}

The coordinate systeam used in this analysis is a right-handed coordinate system defined by the following directions: the $+\hat{z}$ direction is defined as the nominal beam axis, the $+\hat{y}$ direction is defined as vertically upwards and the $\hat{x}$ direction is defined as the horizontal direction which is perpendicular to the beam direction.
The origin is take to be at \SOne.
The $\hat{x}$ and $\hat{z}$ axes are labelled in \citefig{fig:beamSetup}.
In this analysis, the results are given in terms of the angles $\theta$ and $\phi$.
$\theta$ is measured in the $\hat{x}-\hat{z}$ plane with positive angle measured in the $+\hat{x}$ direction while $\phi$ is measured in the $\hat{y}-\hat{z}$ with positive angles measured in the $+\hat{y}$ direction.

\citefig{fig:angDistS1} shows the angular distribution of objects within the beamline as viewed from \SOne.
\citetab{tab:angDistS1} shows the angular extent of various beamline components as measured from \SOne.
Both of these use the data from the survey in order to calculate the results.

\begin{figure}[h]
  \begin{adjustbox}{max totalsize=.8\textwidth, center}
    \input{files/figures/hptpc_beam_flux/angDistS1}
  \end{adjustbox}
  \caption[Angular distribution of objects in the T10 beamline]{Angular distribution of objects within the T10 beamline. The origin here is at \SOne.}
  \label{fig:angDistS1}
\end{figure}

\begin{table}
  \centering
  \caption[Angular extent of components within the T10 beamline with \SOne as the origin]{Angular extent of components within the T10 beamline with \SOne as the origin.}
  \label{tab:angDistS1}
  \begin{tabular}{c c c c c}
    \hline
    \hline
    Object & $\theta_{\text{min}}$ & $\theta_{\text{max}}$ & $\phi_{\text{min}}$ & $\theta_{\text{max}}$ \\
    \hline
    \STwo & $\ang{-3.96} \pm \ang{0.03}$ & $\ang{0.36} \pm \ang{0.03}$ & $\ang{-2.01} \pm \ang{0.03}$ & $\ang{2.94} \pm \ang{0.03}$\\
    \SThree & $\ang{-5.923} \pm \ang{0.004}$ & $\ang{3.040} \pm \ang{0.004}$ & $\ang{-3.215} \pm \ang{0.004}$ & $\ang{3.344} \pm \ang{0.004}$ \\
    \SFour & $\ang{-6.083} \pm \ang{0.003}$ & $\ang{-0.401} \pm \ang{0.003}$ & $\ang{-1.426} \pm \ang{0.003}$ & $\ang{1.771} \pm \ang{0.003}$ \\
    TPC US face & $\ang{-3.59} \pm \ang{0.01}$ & $\ang{-1.44} \pm \ang{0.01}$ & $\ang{-2.66} \pm \ang{0.01}$ & $\ang{2.58} \pm \ang{0.01}$ \\
    TPC DS face & $\ang{-3.778} \pm \ang{0.009}$ & $\ang{-1.806} \pm \ang{0.009}$ & $\ang{-2.440} \pm \ang{0.009}$ & $\ang{2.361} \pm \ang{0.009}$ \\
    \hline 
  \end{tabular}
\end{table}

\citefig{fig:beamlinePics} shows images of the beamline with the various components of the ToF systems as well as the HPTPC and moderator blocks labelled.
In this particular image, all four moderator blocks are placed on the tripod stand.

\begin{figure}[h]
  \centering
  \includegraphics[width=\linewidth]{files/figures/hptpc_beam_flux/S1S2S3S4}
  \caption[Images of the test beam setup with various objects labelled]{Images of the T10 beamline with the apparatus used in the beam test labelled. Left: the downstream part of the beamline. Right: The upstream part of the beamline. Image from~\cite{beampaper}.}
  \label{fig:beamlinePics}
\end{figure}

\SThree and \SFour each have their own independent DAQ systems which process data from \SOne and \STwo plus either \SThree or \SFour.
The data from these two systems is synchronised offline using a signal from the PS indicating the arrival of a beam spill which is recorded by both DAQs.

T10 receives $1-3$ spills from the PS every supercycle, which has a normal duration of \SI{33}{\second}.
The duration of each of these spills is approximately \SI{0.4}{\second}.
The minimum separation in time of these spills is \SI{1}{\second} which means that the beam spill arrival signal has a frequency of less than \SI{1}{\hertz}.
This means that spills in the two DAQs can be matched by using this signal in combination with the DAQ file timestamps.

\citetab{tab:nSpills} shows the number of recorded spills used for each moderator block configuration for the variable block analysis.
One can see that significantly more spills are recorded in the 4 block configuration.
This is because this is the configuration that was used for the majority of the beam test.

\begin{table}
  \caption[Number of recorded spills for each moderator block configuration used in T10 beam flux analysis]{Number of recorded spills for each moderator block configuration used in T10 beam flux analysis}
  \label{tab:nSpills}
  \begin{tabular}{c c}
    \hline
    \hline
    Number of moderator blocks & Recorded spills \\
    \hline
    0 & 257 \\
    1 & 254 \\
    2 & 267 \\
    3 & 220 \\
    4 & 3884 \\
    \hline
  \end{tabular}
\end{table}

\subsection{The upstream beam counters (\SOne and \STwo)}
\label{sec:hptpc_beam_flux:overview:s1s2}

The \SOne beam counter consists of a cross formed from two pieces of plastic scintillator and is shown in the left hand image of \citefig{fig:s1s2Pic}.
This cross measures \SI{40 x 40 x 5}{\milli\metre} and is attached to four 1'' Hamamatsu Photonics R4998 PMTs at each end which are used to read out the light signals.

\begin{figure}[h]
  \centering
  \includegraphics[width=.7\linewidth]{files/figures/hptpc_beam_flux/S1S2FrontOn}
  \caption[The upstream beam counters \SOne and \STwo]{Images of the upstream beam counters \SOne (left) and \STwo (right) from~\cite{beampaper}.}
  \label{fig:s1s2Pic}
\end{figure}

The time resolution of the \SOne beam counter is measured using the DAQ of the upstream ToF and found to be around \SI{30}{\pico\second}.
This measurement is made by taking the average distribution of the four PMT hit times. However, because this measurement is not centred at zero, we instead calculate the quantity
\begin{equation}
  t_{\text{ave}} = \frac{1}{4} ((t_{\text{PMT1}}+t_{\text{PMT2}}) - (t_{\text{PMT3}}+t_{\text{PMT4}}))
  \label{eq:tAve}
\end{equation}
where the $t_{\text{PMT}n}$ refer to the four PMTs used to read out \SOne.
This quantity has the same spread as the average hit time but is centred at zero.
An example of the distribution produced is shown in \citefig{fig:s1Res} which contains the data from one run.

\begin{figure}[h]
  \begin{adjustbox}{max totalsize=.7\textwidth, center}
    \input{files/figures/hptpc_beam_flux/s1TimeRes}
  \end{adjustbox}
  \caption[Example of \SOne time resolution measurement]{An example of an \SOne time resolution measurement made using the quantity $t_{\text{ave}}$, defined in \citeeq{eq:tAve}.}
  \label{fig:s1Res}
\end{figure}

\STwo consists of a single piece of plastic scintillator, measuring \SI{120 x 120 x 5}{\milli\metre} which is read out, via a light guide, by a 2'' Hamamatsu Photonics R1309 PMT~\cite{hamamatsu}.
An image of \STwo is shown on the right of \citefig{fig:s1s2Pic} where the light guide is also indicated.
\STwo is situated \SI{1.419(1)}{\metre} downstream of \SOne and away from the nominal beam axis.
This off-axis positioning means that all of the beam particles impinging on the HPgTPC should pass through \STwo.

The analog signals produced by the PMTs in \SOne and \STwo are fed into LeCroy 620AL NIM discriminator units with a threshold of \SI{30}{\milli\volt}.
These discriminated signals were then fed into a NIM coincidence unit.
The output of this unit was recorded by the DAQ system of the downstream time of flight panel (\SFour).
The signals from \SOne and \STwo were fed individually into the DAQ system of the upstream time of flight panel (\SThree).

\subsection{The upstream time of flight detector (\SThree)}
\label{sec:hptpc_beam_flux:overview:s3}

\SThree (also referred to as the upstream time of flight system) is situated \SI{1.323(2)}{\metre} upstream of the upstream side of the TPC and \SI{10.756(1)}{\metre} in the beamline.
It consists of 22 bars of EJ-200~\cite{ej200} plastic scintillator.
20 of these bars measure \SI{168 x 6 x 1}{\centi\metre} while the remaining 2 measure \SI{150 x 6 x 1}{\centi\metre}~\cite{s3Paper}.
The bars are arranged in a staggered setup with an overlap between the bars of \SI{5}{\milli\metre} while the two smaller bars are placed at the top and bottom of the panel.
The total active area of the detector is \SI{2.0214}{\centi\metre\square}.
Schematic diagrams of \SThree are shown in \citefig{fig:s3Diag} along with dimensions.

\begin{figure}[h]
  \begin{minipage}[t]{.55\linewidth}
    \includegraphics[width=\linewidth]{files/figures/hptpc_beam_flux/uToF_sketch}
  \end{minipage}
  \hfill
  \begin{minipage}[t]{.41\linewidth}
    \includegraphics[width=\linewidth]{files/figures/hptpc_beam_flux/uTOF_rot}
  \end{minipage}
  \caption[Schematic diagrams of \SThree]{Front-on and rotated schematic diagrams of \SThree from~\cite{s3Paper} along with dimensions.}
  \label{fig:s3Diag}
\end{figure}

EJ-200 plastic scintillator (of which the bars are made) has a brightness of \num{10000}~photons/MeV deposited.
Additionally, it has a large optical attenuation length (\SI{4}{\metre}) along with a fast rise time and decay time constant (\SI{0.9}{\nano\second} and \SI{2.1}{\nano\second} respectively.
The scintillation emission spectrum peaks at a wavelength of \SI{435}{\nano\metre}~\cite{ej200}.
In order to increase the light collection capabilities of the bars while excluding background light, they are wrapped in aluminium foil which has a reflectivity of 60\%.

The scintillation photons produced by the bars are detected by S13360-6050PE Hamamatsu Photonics~\cite{hamamatsu} silicon photomultipliers (SiPMs) arranged at either end of the bar.
These photosensors, each measuring \SI{6 x 6}{\milli\metre}, are arranged in groups of eight and then coupled to the end of the bar.
These photomultipliers have a wavelength range that is well suited to the scintillation light produced by the bars (the sensitivity of the SiPMs at a wavelength of \SI{450}{\nano\metre} is 40\%~\cite{hamamatsu}).
The anode signals produced by these SiPMs are read out, summed and shaped by a dedicated circuit as described in~\cite{s3SiPM}.

These signals, along with those from \SOne and \STwo, are then fed into a DAQ based upon the SAMPIC chip, further details of which are given in~\cite{sampic}.

\SThree triggers are formed in the following manner, shown graphically in \citefig{fig:s3Trigger}, and are intended to identify the prescence of a beam particle travelling between \SOne and \SThree.
An \SOne signal is considered to have occurred when at least three of the four \SOne PMTs register a signal above the threshold of \SI{30}{\milli\volt}.
An \SThree signal is deemed to have occurred if the SiPMs on either end of a given bar register a signal above a threshold of \SI{30}{\milli\volt}.
If an \SOne signal and an \SThree signal occur within a time window of \SI{70}{\nano\second}, the DAQ is triggered and writes the event.
The DAQ also acquires signals from the coincidence of \SOne and \STwo as well as the signal indicating the start of the beam spill.

\begin{figure}[h]
  \centering
  \includegraphics[width=.8\linewidth]{files/figures/hptpc_beam_flux/utofTrig}
  \caption[Trigger logic for the upstream time of flight DAQ]{Trigger logic showing the necessary conditions for the identification of a $\SOne-\SThree$ beam particle by the upstream ToF DAQ.}
  \label{fig:s3Trigger}
\end{figure}


\subsection{The downstream time of flight detector (\SFour)}
\label{sec:hptpc_beam_flux:overview:s4}

The design of \SFour is primarily discussed in \citesec{sec:hptpc_dtof_characterisation:dtof}, however it will be briefly revisited here.
\SFour consists of 10 scintillator bars which together form an active area of \SI{1.40 x 0.78}{\metre}.
A diagram of one such bar is shown in \citefig{fig:barDiag}.
Each of these scintillator bars has a PMT attached to each end and these observe the scintillation light produced by charged particles traversing the bars.
A diagram of \SFour is shown in \citefig{fig:dtofDiag}.

The anode signal of each of the PMTs is fed into a LeCroy 620AL NIM discriminator with a threshold of \SI{-20}{\milli\volt}.
Any PMT signals above this threshold are digitised using a time-to-digital converted (TDC)
Additionally, the signal indicating the start of a beam spill as well as a signal indicating a coincidence between \SOne and \STwo were fed into the TDC.
A particle (either beam induced or otherwise) is considered to have been observed in \SFour if a signal above the discriminator threshold is recorded in both PMTs on the same bar, within \SI{20}{\nano\second} of each other.

Unlike the UToF DAQ system, the DToF DAQ is operated in self-triggering mode and thus acquired data both inside and outside the beam spill.


\section{Methods}
\label{sec:hptpc_beam_flux:methods}

In a beamline such as the T10 beamline at CERN, charged particles are selected using by momentum using a magnetic field.
This results in a beam of particles that are all of the same momentum but of different species.
Different particles of the same momentum will take different times to cover the same distance.
The time of flight, $t$, of a particle of mass, $m$, with a momentum, $p$, is given by
\begin{equation}
t = L \sqrt{ \frac{1}{c^{2}} + \frac{m^{2}}{p^{2}} }\, ,
\end{equation}
where $L$ is the distance travelled by the particle.
\citefig{fig:tofVsMom}, left and right, show the time of flight for various particles as a function of particle momentum for the $\SOne - \SThree$ and  $\STwo - \SFour$ distances respectively.
If the beam momentum is known, by measuring a particle's time of flight it should be possible to identify the particle in question.
One can see that, assuming a time resolution of around \SI{1}{\nano\second}, it should be possible to distinguish between deuterons, protons and pions/muons at the momenta used in this study.

\begin{figure}[h]
  \begin{minipage}[t]{.5\linewidth}
    \begin{adjustbox}{max totalsize=\textwidth, center}
      \input{files/figures/hptpc_beam_flux/s1s3Times}
    \end{adjustbox}
  \end{minipage}
  \hfill
  \begin{minipage}[t]{.5\linewidth}
    \begin{adjustbox}{max totalsize=\textwidth, center}
      \input{files/figures/hptpc_beam_flux/s2s4Times}
    \end{adjustbox}
  \end{minipage}
  \caption[Predicted time of flight as a function of momentum for various particle types across the distances used in the HPgTPC beam test]{Predicted time of flight as a function of momentum for various particle types across the distances used in the HPgTPC beam test. Right: the $\SOne - \SThree$ distance. Left: the $\STwo - \SFour$ distance.}
  \label{fig:tofVsMom}
\end{figure}

The basic methods by which the time of flight systems are calibrated are discussed in \citesec{sec:hptpc_beam_flux:methods:general}.
The process used for the identification of particles in \SThree as well as corrections specific to \SThree are discussed in \citesec{sec:hptpc_beam_flux:methods:s3} while the same topics involving \SFour are discussed in \citesec{sec:hptpc_beam_flux:methods:s4}.

\subsection{Analysis methods}
\label{sec:hptpc_beam_flux:methods:general}

\subsection{\SThree specific methods}
\label{sec:hptpc_beam_flux:methods:s3}

\subsection{\SFour specific methods}
\label{sec:hptpc_beam_flux:methods:s4}

\section{Results}
\label{sec:hptpc_beam_flux:results}

Beam flux measurements made with the \SThree detector are detailed in \citesec{sec:hptpc_beam_flux:results:s3} while those made with the \SFour detector are detailed in \citesec{sec:hptpc_beam_flux:results:s3}.
A comparison of the data with simulation is shown in \citesec{sec:hptpc_beam_flux:results:MCData}.

\subsection{Flux measurements at \SThree}
\label{sec:hptpc_beam_flux:results:s3}

\subsection{Flux measurements at \SFour}
\label{sec:hptpc_beam_flux:results:s4}

\subsection{Comparison with simulation}
\label{sec:hptpc_beam_flux:results:MCData}

\begin{figure}[h]
  \begin{adjustbox}{max totalsize=.7\textwidth, center}
    \input{files/figures/hptpc_beam_flux/tofS4Sim}
  \end{adjustbox}
  \caption[]{}
  \label{fig:tofS4Sim}
\end{figure}

\begin{table}
  \centering
  %% NEED TO CHANGE CAPTION SO IT IS NOT THE SAME AS THE BEAM FLUX PAPER
  \caption[Comparison of number of protons reaching \SThree and \SFour in data and Monte Carlo]{Ratio of number of protons reaching \SFour to number protons reaching \SThree for different numbers of moderator blocks in MC and data. In each instance, the combined statistical and systematic errors are shown.}
  \begin{tabular}{c|c c c}
    \hline
    \hline
    Number of moderator blocks & Monte Carlo & Data & Data/MC\\
    \hline
    $0$ & $0.027 \pm 0.003$ & $0.049 \pm 0.007$ & $1.8 \pm 0.3$ \\
    $1$ & $0.067 \pm 0.005$ & $0.09 \pm 0.01$ & $1.3 \pm 0.2$ \\
    $2$ & $0.084 \pm 0.007$ & $0.10 \pm 0.01$ & $1.2 \pm 0.2$ \\
    $3$ & $0.06 \pm 0.01$ & $0.036 \pm 0.007$ & $0.7 \pm 0.2$ \\
    $4$ & $0.011 \pm 0.001$ & $0.008 \pm 0.001$ & $0.7 \pm 0.1$ \\
    \hline
  \end{tabular}
  \label{tab:s3s4Ratios}
\end{table}

