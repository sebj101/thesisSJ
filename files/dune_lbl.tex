\chapter{DUNE long baseline analysis}
\label{sec:dune_lbl}

%%% Overall point of this chapter: How do our uncertainties relate to our ability to measure CPV
As covered in \citechap{sec:dune}, DUNE's primary goal is to make a measurement of CP violation (CPV) in the lepton sector.
Prior to any construction of the experiment, it is important to assess DUNE's eventual sensitivity to both CPV and other oscillation physics, such as the neutrino mass ordering.

\section{Summary of DUNE systematic uncertainties}
\label{sec:dune_lbl:systs}

This section gives a summary of the systematic uncertainties used in DUNE's long baseline analysis and where they are derived from.
\citesec{sec:dune_lbl:systs:flux} details the systematics deriving from lack of knowledge about the neutrino beam (commonly referred to as the `flux' systematics).
\citesec{sec:dune_lbl:systs:xsec} gives details of those systematics relating to lack of knowledge surrounding neutrino interactions with matter.
Finally, \citesec{sec:dune_lbl:systs:det} outlines the systematic uncertainties which derive from the uncertainty surrounding detector effects, for example the energy scale of the detector.

\subsection{Flux}
\label{sec:dune_lbl:systs:flux}

Uncertainties in the neutrino beam flux primarily arise from two sources: uncertainties in the production of hadrons by protons striking the beam target and uncertainties in the design parameters of the beam such as the horn currents or positioning (commonly referred to as the ``focussing uncertainties''.

The focussing uncertainties are evaluated by varying the beamline parameters within their tolerances and observing the resulting changes in the neutrino fluxes.
Hadron production uncertainties are estimated using uncertainties from thin target data experiments such as NA49~\cite{na49} with large uncertainties assigned to those interactions that are not covered by data.

\citefig{fig:fluxUncertainties} shows these uncertainties as a function of neutrino energy for the \numu and \anumu fluxes in both neutrino and antineutrino mode.
One can see that, at nearly all energies, hadron production uncertainties are larger than focussing uncertainties.

\begin{figure}[h]
  \centering
  \includegraphics[width=.8\linewidth]{files/figures/dune_detector/fluxUncertainties}
  \caption[Far detector flux uncertainties for \numu and \anumu]{Far detector \numu and \anumu flux uncertainties as a function of neutrino energy, from~\cite{tdrVol2}. The uncertainties are separated into those resulting from hadron production and those resulting from the focussing uncertainties.}
  \label{fig:fluxUncertainties}
\end{figure}

\subsection{Neutrino interaction (cross-section)}
\label{sec:dune_lbl:systs:xsec}

%Uncertainties in the neutrino interaction model come from a variety of sources. 
The primary model used in the DUNE long-baseline analysis is that provided by the chosen neutrino interaction generator, Generates Events for Neutrino Interaction Experiments (GENIE)~\cite{genie}.
The version of GENIE used in the DUNE long-baseline analysis is v2.12.0~\cite{tdrVol2}.

The interaction model takes a neutrino flux and provides a spectrum of final states produced by said neutrinos interacting with the target medium.
For the most part, these interactions are modelled as factorising the interaction into three parts: an initial nuclear state, the neutrino interaction with a nucleon and the propagation of final state particles through the nucleus.

%% Might need to move section on neutrino nucleus interactions to here

The systematic uncertainties used in this analysis relate to all three elements of this modelling picture amongst other categories.
The interaction model systematics can be divided into categories covering each of the following areas~\cite{tdrVol2}: 
\begin{itemize}
	\item Initial nuclear state
	\item Quasielastic processes
	\item Multinucleon (2p2h) processes
	\item Pion production processes
	\item High $W$ processes and neutral current processes
	\item Final state interactions
	\item Neutrino flavour dependent uncertainties
\end{itemize}

Many of the systematic uncertainties are included as standard in GENIE, while others are developed specifically for the DUNE long-baseline analysis.
These uncertainties take the form of either continuous weights or discrete model comparisons.
These uncertainties are derived from a variety of sources, including freedoms in theoretical models, current experimental measurements and observed discrepancies between models and experiments.

\subsection{Detector}
\label{sec:dune_lbl:systs:det}

Detector systematics in the DUNE long-baseline analysis primarily take the form of bin-to-bin shifts, rather than the weights typically used for the flux and cross-section systematics.
For various particle types there exist multi-parameter energy scale shifts of the form
\begin{equation}
E_{\alpha,~\text{reco}}' = E_{\alpha,~\text{reco}} \left( p_{0} + p_{1} \sqrt{E_{\alpha,~\text{reco}}} + \frac{p_{2}}{\sqrt{E_{\alpha,~\text{reco}}+0.1}} \right) \, ,
\label{eq:energyResponse}	
\end{equation}
where the $p_{n}$ are allowed to vary in any fits.
\citetab{tab:energyScaleParams} shows the $1\sigma$ values of the $p_{n}$ for each of the particle types.
All of these uncertainties are treated as uncorrelated between the near and far detectors.

The values of the $p_{0}$ (the absolute scale factors) are motivated by those values achieved in current long baseline neutrino experiments which use similar reconstruction techniques.
For example, the NOvA experiment quotes an absolute muon energy scale of $<1\%$ and a proton energy scale of 5\%~\cite{nova2018}.

\begin{table}
	\caption[$1\sigma$ uncertainties for the detector energy response used in the DUNE long baseline analysis]{$1\sigma$ uncertainties for the detector energy response used in the DUNE long baseline analysis. The muon curvature uncertainty only applies to those muons in the near detector which pass into the magnetised section of the detector.}
	\label{tab:energyScaleParams}
	\centering
	\begin{tabular}{c c c c}
		\hline
		\hline
		Particle types & \multicolumn{3}{c}{$1\sigma$ variation} \\
		& $p_{0}$ & $p_{1}$ & $p_{2}$ \\
		\hline
		All, except muons      & 2\%   & 1\%   & 2\%   \\
		$\mu$ (range)          & 2\%   & 2\%   & 2\%   \\
		$\mu$ (curvature)      & 1\%   & 1\%   & 1\%   \\
		$p$, \pipm             & 5\%   & 5\%   & 5\%   \\
		$e$, $\gamma$, \pizero & 2.5\% & 2.5\% & 2.5\% \\
		$n$                    & 20\%  & 30\%  & 30\% \\
		\hline
	\end{tabular}
\end{table}

\citefig{fig:protonEScale} shows 10 possible realisations of the proton energy response.
To produce each of these response functions, the $p_{n}$ are each independently thrown according to a Gaussian distribution with the appropriate width from \citetab{tab:energyScaleParams}.
One can see that between the different throws there are significant differences in both the magnitude and shape of response function between different throws.

\begin{figure}[h]
	\begin{adjustbox}{max totalsize=.6\textwidth, center}
		\input{files/figures/dune_lbl/energyResponse}
	\end{adjustbox}
	\caption[Example proton energy responses as a function of proton energy.]{Example proton energy responses as a function of proton energy. The functions are derived from \citeeq{eq:energyResponse} with Gaussian throws for $p_{0}$, $p_{1}$ and $p_{2}$.}
	\label{fig:protonEScale}
\end{figure}

Additionally, a 2\% uncertainty is assigned to the the resolution of each of muon, charged hadrons, electromagnetic objects while a 40\% uncertainty is applied to the resolution of neutrons.

There are however, some detector systematics which are implemented as weights. 
Notably a normalisation uncertainty of 1\% is applied to both \numu and \nue events.

Furthermore, systematic uncertainties for the near detector acceptance are devised based upon simulation.
The acceptance of the DUNE ND is quite different to that of the FD due to the vastly different dimensions of the two detectors
The muon acceptance of the DUNE near detector as a function of muon transverse and longitudinal momentum is shown in \citefigL{fig:ndAcceptance}. 
Muons are considered to be accepted if they either stop within ND-LAr or if they exit ND-LAr and pass into ND-GAr where their momentum may be measured from track curvature.
Those muons which exit ND-LAr without passing into ND-GAr are not accepted.

Neutrino events are rejected where they produce deposits of more than \SI{30}{\MeV} in the veto region of ND-LAr.
This veto region is defined as the outer \SI{30}{\cm} of the active region on all sides.
The resulting hadronic acceptance is shown in \citefigR{fig:ndAcceptance}.
One can see that the acceptance declines sharply as hadronic energy increases.

\begin{figure}[h]
	\begin{minipage}[t]{.5\textwidth}
		\begin{adjustbox}{max totalsize=\linewidth, center}
			\input{files/figures/dune_lbl/muonAcc}
		\end{adjustbox}
	\end{minipage}
	\hfill
	\begin{minipage}[t]{.5\textwidth}
		\begin{adjustbox}{max totalsize=\linewidth, center}
			\input{files/figures/dune_lbl/hadAcc}
		\end{adjustbox}
	\end{minipage}
	\caption[Muonic and hadronic acceptance for CC neutrino interactions in ND-LAr]{Left: Muonic acceptance for CC muon neutrino interactions in ND-LAr as a function of transverse and longitudinal muon momentum. Right: Hadronic acceptance for CC muon neutrino interactions in ND-LAr as a function of true hadronic energy. Both from~\cite{Abi:2020qib}.}
	\label{fig:ndAcceptance}
\end{figure}

The uncertainty on the muon and hadron acceptance is produced from the respective plots in \citefig{fig:ndAcceptance} with a higher uncertainty in regions where the acceptance is rapidly changing and thus vulnerable to mismodelling.

Unlike their FD counterparts, the ND detector parameters are not allowed to vary in the fit.
Instead, they are incorporated into a covariance matrix.
This covariance matrix is formed by throwing all ND detector uncertainties simultaneously according to their documented uncertainties and comparing the resulting spectra with the nominal prediction.
The bin-to-bin covariance is then determined using these comparisons.
This method protects against over-constraining of ND parameters due to the limitations of the simplified ND reconstruction.

\section{DUNE sensitivites}
\label{sec:dune_lbl:sensitivities}

\subsection{General sensitivity methods}
\label{sec:dune_lbl:sensitivities:general}

DUNE's oscillation sensitivities are computed using the CAFAna package.
%% Move CAFAna stuff here I think

The oscillation sensitivities are computed by simultaneously fitting the oscillation parameters and nuisance parameters to four FD spectra (\numu disappearance, \anumu disappearance, \nue appearance and \anue appearance) and the nuisance parameters to the two ND spectra (\numu unoscillated and \anumu unoscillated).
Examples of the four FD spectra are shown in \citefig{fig:fdEventRates}.
The two ND samples are two dimensional, binned in reconstructed neutrino energy and reconstructed inelasticity, $y_{\text{reco}}$, where
\begin{equation}
	y_{\text{reco}} = 1 - \frac{E_{\mu,~\text{reco}}}{E_{\nu,~\text{reco}}} \, ,
\end{equation}
where $E_{\mu,~\text{reco}}$ and $E_{\nu,~\text{reco}}$ are the reconstructed muon and neutrino energies respectively.
These two-dimensional samples are shown in \citefig{fig:ndEventRates}.

\begin{figure}[h]
	\begin{minipage}[t]{.5\linewidth}
		\begin{adjustbox}{max totalsize=\linewidth, center}
			\input{files/figures/dune_lbl/h2NDNumuFHC}
		\end{adjustbox}
	\end{minipage}
	\hfill
	\begin{minipage}[t]{.5\linewidth}
		\begin{adjustbox}{max totalsize=\linewidth, center}
			\input{files/figures/dune_lbl/h2NDNumuRHC}
		\end{adjustbox}
	\end{minipage}
	\caption[Two-dimensional DUNE ND event rates used in the long-baseline analysis]{Two-dimensional DUNE ND event rates used in the long-baseline analysis. Left: Sample with the beam in neutrino mode. Right: Sample with the beam in antineutrino mode.}
	\label{fig:ndEventRates}
\end{figure}

In these fits Gaussian penalty terms on \thetai{12}, \deltami{21} and $\rho$ are applied (since DUNE will not be able to constrain these parameters).
The width and central values of these penalty terms are taken from the NuFit 4.0 global fit~\cite{nufit4}.
A penalty term on \thetai{13} may also be included.
DUNE will eventually be able to constrain \thetai{13} with a similar precision to existing reactor experiments. 
However, this is expected to take around 15 years of running~\cite{tdrVol2}.
The other oscillation parameters, \ssthetai{23}, \deltami{32} and \dcp are allowed to vary freely.

The compatibility of a particular set of near and far detector data with a given set of oscillation parameters and nuisance parameter values is evaluated using a negative log-likelihood ratio.
In the high statistics limit, this log-likelihood ratio converges to a $\chi^{2}$~\cite{pdg2018}.
The expression for this $\chi^{2}$ for a given set of oscillation parameters, $\bm{\theta}$, and nuisance parameters, $\vb{x}$ is given by
\begin{align}
	\chi^{2} \left( \bm{\theta}, \vb{x} \right) &= -2 \log \mathcal{L} \left( \bm{\theta}, \vb{x} \right) \\
	&= 2 \sum_{i}^{N_{\text{bins}}} \left[ M_{i} (\bm{\theta}, \vb{x}) - D_{i} + D_{i} \ln \left( \frac{D_{i}}{M_{i}(\bm{\theta}, \vb{x})} \right) \right] + \sum_{j}^{N_{\text{systs}}} \left[ \frac{\Delta x_{j}}{\sigma_{j}} \right]^{2} \\
	&+ \sum_{k}^{N^{\text{ND}}_{\text{bins}}} \sum_{l}^{ N_{\text{bins}}^{\text{ND}} } \left(  M_{k} (\vb{x}) - D_{k} \right) V_{kl}^{-1} \left( M_{l}(\vb{x}) - D_{l} \right) \, ,
\end{align}
where $D_{i}$ and $M_{i}(\bm{\theta}, \vb{x})$ are the fake data and Monte Carlo expectation for a given set of $\bm{\theta}$ and $\vb{x}$ for the $i$th bin respectively. 
$V_{kl}$ is the ND covariance matrix mentioned in \citesec{sec:dune_lbl:systs:det}.
$\Delta x_{j}$ is the difference between the nominal and current value of the $j$th nuisance parameter and $\sigma_{j}$ is the prior uncertainty on said parameter.
The best fit values for the $\bm{\theta}$ and $\vb{x}$ occur at the minimum value of $\chi^{2}$.

In order to avoid reporting a false minimum $\chi^{2}$ as the true one, each fit is repeated at multiple sets of oscillation parameters. 
The values of \dcp tested are $-\pi$, $-\pi/2$, 0 and $\pi/2$. 
Additionally, both neutrino mass hierarchies are tested along with both octants of \thetai{23}.
From these, the fit which provides the lowest \chisquare is selected as the best fit point.

%% Something about Asimovs

\subsection{Constraints on systematic parameters}

\citefig{fig:systConstraints} shows the systematics used in the DUNE long-baseline analysis.
For each parameter, the ratio of the post-fit to pre-fit uncertainties is shown.
The constraints with just the FD are shown in red, while the green lines show the combined near and far detector constraints.
One can see that, as expected, the FD detector parameters are not significantly more constrained with the addition of the ND samples. 

\begin{figure}[h]
	\centering
	\includegraphics[width=.8\linewidth]{files/figures/dune_lbl/constraintsWithLines}
	\caption[DUNE systematic constraints with and without a near detector constraint]{Ratio of post-fit to pre-fit systematic constraints for a 15 year staged exposure. The constraints with (green) and without a ND constraint (red) are shown. The systematics are separated by category. Taken from~\cite{Abi:2020qib}.}
	\label{fig:systConstraints}
\end{figure}

There is also significant variation in the level at which various cross-section parameters are constrained. 
For the most part, these parameters are not well constrained by the FD only, showing the utility of the ND.
Similarly, the flux parameters become significantly more constrained with the addition of the ND.

\subsection{Mass hierarchy}
\label{sec:dune_lbl:sensitivities:mh}

DUNE's sensitivity to the neutrino mass hierarchy is measured using the statistic $\Delta \chisquare = \chi^{2}_{\text{B}} - \chi^{2}_{\text{A}}$, where $A$ and $B$ are two possible hypotheses.
This provides a measure of how well the data can exclude hypothesis $B$ in favour of $A$.
In the case of the neutrino mass hierarchy, the relevant question is to what level DUNE can exclude the inverted hierarchy in favour of the normal hierarchy (in the case of true normal hierarchy), $\chi^{2}_{\text{IH}} - \chi^{2}_{\text{NH}}$, and vice versa if the hierarchy is truly inverted.

This is verified for various true values of \dcp, for both hierarchies in \citefig{fig:mhSens}.
For each \dcp point $\Delta \chisquare$ is calculated by first calculating $\chi^{2}_{\text{true}}$ (where this can be either the normal or inverted hierarchy) and then calculating the \chisquare value for the same value of \dcp but with the hierarchy fixed to the incorrect value.
The square root of $\Delta \chisquare$ is then taken to provide a crude significance.

\begin{figure}[h]
	\begin{adjustbox}{max totalsize=.6\linewidth, center}
		\input{files/figures/dune_lbl/mh_sens_both}
	\end{adjustbox}
	\caption[DUNE sensitivity to the neutrino mass hierarchy as a function of true \dcp.]{DUNE sensitivities to the neutrino mass hierarchy as a function of true \dcp for a 7 year staged exposure. The black line shows the statistics only case. The blue line shows the case where only the detector systematics are used. The red line shows the case where all systematics are used. Solid lines show the case for true normal mass hierarchy while dashed lines show the case for true inverted mass hierarchy.}
	\label{fig:mhSens}
\end{figure}

\citefig{fig:mhSens} shows the results of this in the statistics only case (for 7 years of staged running), with just the detector systematics and with all the systematics included.
It is immediately apparent that DUNE will be highly sensitive to the neutrino mass hierarchy, surpassing the common particle physics threshold of $\sqrt{\Delta \chisquare} = 5$ at all values of \dcp and for both true hierarchies.
One can see that the addition of detector systematics reduces the sensitivity somewhat, with remaining systematics reducing it further.
However, it is clear that, even with a fairly substantial increase in systematic uncertainties, DUNE will still be able to quickly resolve the neutrino mass hierarchy.

\subsection{Charge-parity symmetry violation}
\label{sec:dune_lbl:sensitivities:cpv}

In a similar manner to the mass hierarchy, DUNE's sensitivity to CP-violation in the lepton sector is calculated using the likelihood ratio, $\Delta \chisquare$.
In this case DUNE is attempting to exclude the models where $\dcp = 0,~\pi$ (CP-conserving values of \dcp).
Therefore, $\Delta \chisquare = \chi^{2}_{\dcp=0,\pi} - \chi^{2}_{\text{CPV}}$.

\begin{figure}[h]
	\begin{minipage}[t]{.5\linewidth}
		\begin{adjustbox}{max totalsize=\linewidth, center}
			\input{files/figures/dune_lbl/cpv_sens_nh}
		\end{adjustbox}
	\end{minipage}
	\hfill
	\begin{minipage}[t]{.5\linewidth}
		\begin{adjustbox}{max totalsize=\linewidth, center}
			\input{files/figures/dune_lbl/cpv_sens_ih}
		\end{adjustbox}
	\end{minipage}
	\caption[DUNE sensitivities to CP-violation in the lepton sector as a function of true \dcp.]{DUNE sensitivities to CP-violation in the lepton sector as a function of true \dcp. The black line shows the statistics only case. The blue line shows the case where only the detector systematics are used. The red line shows the case where all systematics are used.}
	\label{fig:cpvSens}
\end{figure}

